@using TaskScheduler.Core.Models
@{
    ViewData["Title"] = "Task Management";
}

<h2>Task Scheduler Management</h2>

@(Html.DevExtreme().DataGrid<ScheduledTask>()
    .ID("gridContainer")
    .DataSource(d => d.Mvc()
        .Controller("Tasks") // ชี้ไปที่ TasksController ที่เราสร้าง
        .LoadAction("Get")
        .InsertAction("Post")
        .UpdateAction("Put")
        .DeleteAction("Delete")
        .Key("Id") // Key หลักของตาราง
    )
    .ShowBorders(true)
    .RepaintChangesOnly(true)
    .Editing(e => e
        .Mode(GridEditMode.Popup) // ใช้ Popup ในการแก้ไข/เพิ่ม
        .AllowAdding(true)
        .AllowUpdating(true)
        .AllowDeleting(true)
        .Popup(p => p
            .Title("Task Info")
            .ShowTitle(true)
            .Width(700)
            .Height(525)
        )
        .Form(f => f.Items(items => {
            items.AddGroup()
                .ColCount(2)
                .ColSpan(2)
                .Items(groupItems => {
                    groupItems.AddSimpleFor(m => m.Name);
                    groupItems.AddSimpleFor(m => m.IsActive);
                    groupItems.AddSimpleFor(m => m.HttpMethod)
                        .Editor(editor => editor.SelectBox().Items(new[] { "GET", "POST", "PUT", "DELETE" }));
                });
            items.AddGroup()
                .Caption("API Configuration")
                .ColCount(1)
                .ColSpan(2)
                .Items(groupItems => {
                    groupItems.AddSimpleFor(m => m.ApiUrl);
                    groupItems.AddSimpleFor(m => m.Headers).Editor(e => e.TextArea().Height(100));
                    groupItems.AddSimpleFor(m => m.Body).Editor(e => e.TextArea().Height(100));
                });
        }))
    )
    .Columns(columns => {
        columns.AddFor(m => m.Id).Width(50).AllowEditing(false);
        columns.AddFor(m => m.Name).Caption("Task Name");
        columns.AddFor(m => m.ApiUrl).Caption("API URL");
        columns.AddFor(m => m.HttpMethod).Width(80);
        columns.AddFor(m => m.IsActive).Width(80);
        
        // ปุ่ม Trigger/Run (Option เสริม)
        columns.Add().Type(GridCommandColumnType.Buttons)
            .Buttons(b => {
                b.Add().Name(GridColumnButtonName.Edit);
                b.Add().Name(GridColumnButtonName.Delete);
            });
    })
    .Paging(p => p.PageSize(10))
    .FilterRow(f => f.Visible(true))
    .HeaderFilter(f => f.Visible(true))
)