@using TaskScheduler.Core.Models
@using DevExtreme.AspNet.Mvc

@{
    ViewData["Title"] = "Task Scheduler";
}

<div class="container mt-4">
    <h2>Task Scheduler Management</h2>
    
    @(Html.DevExtreme().DataGrid<ScheduledTask>()
        .ID("gridTasks")
        .DataSource(d => d.Mvc()
            .Controller("Tasks")  // ชี้มาที่ TasksController ที่เราเพิ่งสร้าง
            .LoadAction("Get")
            .InsertAction("Post")
            .UpdateAction("Put")
            .DeleteAction("Delete")
            .Key("Id")
        )
        .ShowBorders(true)
        .RepaintChangesOnly(true)
        .Editing(e => e
            .Mode(GridEditMode.Popup)
            .AllowAdding(true)
            .AllowUpdating(true)
            .AllowDeleting(true)
            .Popup(p => p
                .Title("Task Info")
                .ShowTitle(true)
                .Width(700)
                .Height(600)
            )
            .Form(f => f.Items(items => {
                items.AddGroup()
                    .Caption("General Info")
                    .ColCount(2)
                    .ColSpan(2)
                    .Items(groupItems => {
                        groupItems.AddSimpleFor(m => m.Name);
                        groupItems.AddSimpleFor(m => m.IsActive);
                    });

                items.AddGroup()
                    .Caption("API Configuration")
                    .ColCount(1)
                    .ColSpan(2)
                    .Items(groupItems => {
                        groupItems.AddSimpleFor(m => m.HttpMethod)
                            .Editor(editor => editor.SelectBox().Items(new[] { "GET", "POST", "PUT", "DELETE" }));
                        groupItems.AddSimpleFor(m => m.ApiUrl);
                        groupItems.AddSimpleFor(m => m.Headers).Editor(e => e.TextArea().Height(80));
                        groupItems.AddSimpleFor(m => m.Body).Editor(e => e.TextArea().Height(100));
                    });
            }))
        )
        .Columns(columns => {
            columns.AddFor(m => m.Id).Width(60).AllowEditing(false);
            columns.AddFor(m => m.Name).Caption("Task Name");
            columns.AddFor(m => m.ApiUrl).Caption("Target URL");
            columns.AddFor(m => m.HttpMethod).Width(100).Caption("Method");
            columns.AddFor(m => m.IsActive).Width(80).Caption("Active");
        })
        .Paging(p => p.PageSize(10))
        .FilterRow(f => f.Visible(true))
        .HeaderFilter(f => f.Visible(true))
    )
</div>